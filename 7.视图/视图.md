# 概述

视图是从一个或多个表中查询数据的另外一种方式。利用视图，用户可以集中、简化、定制数据库，同时还可以提供安全保证。

视图是一个***\*虚拟表\****，其内容由查询定义。同真实的表一样，视图包含一系列带有名称的行和列数据。行和列数据来自定义视图的查询所引用的表，并且在引用视图时动态生成。

简单来说，视图是由select结果组成的表。

***\*什么时候需要视图？\****

如果某个查询结果出现的非常频繁，也就是，要经常拿这个查询结果来做子查询。

***\*特性\*******\*：\****

1、视图是对若干张基本表的引用，一张虚表，查询语句执行的结果；

2、不存储具体的数据（基本表数据发生了改变，视图也会跟着改变）；

视图所对应的数据并不以视图结构存储在数据库中，而是存储在视图所引用的表中。

3、可以跟基本表一样，进行增删改查操作（增删改操作有条件限制）。

***\*视图与表的关系？\****

视图是表的查询结果，自然表的数据变了，会影响视图的结果。

***\*能否对视图进行增删改查的操作？\****

1、视图的增删改也会影响表；

2、但视图并不总是能够增删改的。

***\*视图的存放位置？\****

视图存放在information_schema数据库下的views表里。

 

# 作用

## 优点

1、简化查询语句

在多表之间进行一系列复杂查询时，利用视图可以将查询条件层层分解，简化查询过程。比如按照要求查询每个员工的工号，工资等信息。

2、定制数据。

视图能够让不同的用户、以不同的方式看到不同或相同的数据集。因此，当有许多不同水平的用户共用同一数据库时，这显得极为重要。比如，我们想让公司的用户访问某些职员记录，但不想让这些用户获得诸如医疗卡号或工资之类的信息，那么就可以创建一个视图，只为他们提供应该看到的信息。

3、合并分隔数据。

在有些情况下，由于表中数据量太大，在表的设计时，常将表进行水平分割或垂直分割，但表的结构的变化却会对应用程序产生不良的影响。使用视图就可以重新保持原有的结构关系，从而使外模式保持不变，原有的应用程序仍可以通过视图来重载数据。

4、可以进行权限控制

把表的权限封闭，但是开放相应的视图权限，视图里只开放部分数据列。

比如把员工的工资表的权限关闭，但是开放查询员工的发放工资的次数的权限。

5、安全性

创建一个视图，定义好该视图所操作的数据，之后将用户权限与视图绑定，这样的方式是使用了一个特性：grant语句可以针对视图进行授予权限。

4、提高数据的独立性

大数据表分表的时候，比如某张表的数据有100万条，那么可以将这张表分成4个视图。

## 缺点

使用视图主要有两个缺点。

1、性能。

由于视图是虚拟的表，在使用包括视图引用的SQL语句时，数据库除了执行所键入的SQL语句中的查询或更新之外，还要告诉DBMS执行定义视图的查询，这就影响了查询效率。

2、更新限制。

不是所有的视图都是可更新的。目前，SQL将可更新的视图限制为基于对单个表的，并且没有GROUP BY或者HAVING子句的查询。除此之外，为了使视图是可更新的，视图不能使用聚集函数、计算的列或SELECT DISTINCT子句。

由于SQL对更新视图的限制，用户不能总是用视图来代替表。另外，在使用视图的情况下，我们要综合考虑使用视图的优势和DBMS每次执行创建视图的SQL语句引起的性能损失。

# 操作

## 创建

基本格式：create view view_name as (select …from …);

 

**CREATE详细格式：**

CREATE [OR REPLACE][ALGORITHM] = {UNDEFINED|MEGER|TEMPTABLE}

​			VIEW 视图名 [{属性清单}]

​			[WITH [SASCDED|LOCAL] CHECK OPTION];

**其中：**

CREATE表示创建新的视图；REPLACE表示替换已经创建的视图；

**ALOGORITHM参数：**

**Merge：**合并的执行方式，每当执行的时候，先将我们视图的SQL语句与外部查询视图的SQL语句混合在一起，最终执行。

处理方式替换式，可以进行更新真实表中的数据。

**TEMPTABLE：**临时表模式，每当查询的时候，将视图所使用的select语句生成一个结果的临时表，再在当前的临时表内进行查询。

具化式，由于数据存储在临时表中，所以不可以进行更新操作。

**UNDEFINED：**没有定义ALOGORITHM参数，UNDEFINED表示MySQL将自动选择算法。

**说明：**MySQL更倾向于选择替换式，因为它更加有效。

**WITH CHECK OPTION：**更新数据时不能插入或更新不符合视图限制条件的记录，即通过视图进行的修改，必须也能通过该视图看到修改后的结果。

**LOCAL和CASADED：**为可选参数，决定了检查测试的范围，默认值为CASCADED.

 

关于视图我们还要强调两点。

• 视图创建后，在数据字典中只存放视图的定义，而其中的SELECT语句并不执行。

• 只有当用户对视图进行操作时，才按照视图的定义将数据从基本表中取出。

## 查看

查看视图是查看数据库中已存在的视图的定义。查看视图必须要有SHOW VIEW的权限，MySQL数据库下的user表中保存着这个信息。查看视图的方法包括DESCRIBE、SHOW TABLE STATUS和SHOW CREATE VIEW。

**查看视图的定义：**

show table status [from 视图名称][like ‘匹配’];

**查看权限：**

select drop_priv from mysql.user where user=’root’;

**查看视图内容：**

select * from view_name where …;

### DESCRIBE

DESCRIBE可以用来查看视图，具体的语法如下：

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F66.tmp.jpg) 

### SHOW TABLE STATUS

查看视图的信息可以通过SHOW TABLE STATUS的方法完成，具体的语法如下：

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F76.tmp.jpg) 

### SHOW CREATE VIEW

使用SHOW CREATE VIEW语句可以查看视图详细定义，语法如下：

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F77.tmp.jpg) 

### views表查看视图

在MySQL中，information_schema数据库下的views表中存储了所有视图的定义。通过对views表的查询，可以查看数据库中所有视图的详细信息，查询语句如下：

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F78.tmp.jpg) 

## 修改

修改视图是指修改数据库中存在的视图，当基本表的某些字段发生变化的时候，可以通过修改视图来保持与基本表的一致性。MySQL中通过CREATE OR REPLACE VIEW语句和ALTER语句来修改视图。

### CREATE OR REPLACE VIEW

语法格式：create or replace view view_name as (select … from …);)

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F89.tmp.jpg) 

在MySQL中修改视图，可使用CREATE OR REPLACE VIEW语句，语法如下：

 

可以看到，修改视图的语句和创建视图的语句是完全一样的。当视图已经存在时，修改语句对视图进行修改；当视图不存在时，创建视图。

### ALTER

ALTER语句是MySQL提供的另外一种修改视图的方法，语法如下：

![img](file:///C:\Users\大力\AppData\Local\Temp\ksohtml\wps9F8A.tmp.jpg) 

 

## 更新

更新视图是指通过视图来插入、更新、删除表中的数据，因为视图是一个虚拟表，其中没有数据。通过视图更新的时候都是转到基本表上进行更新的，如果对视图增加或者删除记录，实际上是对其基本表增加或者删除记录。

 

某些视图是可以更新的，可以在诸如UPDATE、DELETE或者INSERT等语句中使用它们，以更新基表的内容。对于可更新的视图，在视图中的行和基表中的行之间必须具有一对一的关系。还有一些特定的其他结构，这类结构会使得视图不可更新。更具体地讲，如果视图包含下述结构中的一种，那么它就是不可更新的：

1、聚合函数（SUM，MAX，MIN，COUNT）

2、DISTINCT

3、GROUP BY

4、HAVING

5、UNION或UNION ALL

6、位于选择列表中的子查询

7、JOIN

8、FROM子句中的不可更新视图

9、WHERE子句中的子查询，引用FROM子句中的表

10、仅引用文字值（在该情况下，没有要更新的基本表）

11、ALGORITHM=TEMPTABLE（使用临时表总会使视图成为不可更新的）

 

当视图中包含有如下内容时，视图的更新操作将不能被执行：

（1）视图中不包含基表中被定义为非空的列。

（2）在定义视图的SELECT语句后的字段列表中使用了数学表达式。

（3）在定义视图的SELECT语句后的字段列表中使用聚合函数。

（4）在定义视图的SELECT语句中使用了DISTINCT、UNION、TOP、GROUP BY或HAVING子句。

## 删除

只能删除视图的定义，不能删除数据，必须有drop权限：

DROP VIEW [IF EXISTS] view_name [RESTRICT | CASCADE];

删除多个：

DROP VIEW IF EXISTS department_view1,department_view2;

 

# 使用原则

一般情况下，创建和使用视图应遵循以下几点原则。

• 和表一样，视图必须有惟一的名字。不仅视图之间不允许有相同的名字，并且视图与表也不允许拥有相同的名字。

• 视图的创建个数不受限制，用户可以创建任意多个视图。

• 用户要创建视图，必须从数据库管理员那里得到创建权限。

• 视图可以嵌套，即可以创建视图的视图。

• 一些数据库管理系统（如SQL Server）禁止用户在查询语句中使用ORDER BY子句。

 